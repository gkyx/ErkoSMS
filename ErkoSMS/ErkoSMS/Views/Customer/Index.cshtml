@{
    ViewBag.Title = "Müşteriler";
}

<h2>@ViewBag.Title</h2>

<p>
    <span class="btn btn-success" id="createCustomerButton" data-erkosms-role="ajax-dialog-button" data-erkosms-targetaction="Customer/CreateCustomer">
        <span class="fa fa-user-plus"></span> Müşteri Ekle
    </span>
</p>

<div id="filteringDiv" style="margin-top:20px">
    <input type="text" id="customerName" placeholder="Müşteri Adı" />
    <input type="button" id="searchButton" value="Ara" />
    <input type="button" id="getAllButtomn" value="Hepsini getir" />
</div>

<div id="customerTableDiv row" style="margin-top:20px;width:1400px">
    <table id="customerListTable" class="table table-bordered table-condensed table-hover table-responsive table-striped"></table>
</div>
<script>
    var destroyTable = function () {
        var tb = $("#customerListTable");

        if ($.fn.dataTable.isDataTable(tb))
            tb.DataTable().destroy();

        tb.empty();
    };

    // Edit record
    $('#customerListTable').on('click', 'td.editor-edit', function (e) {
        e.preventDefault();
        var rowToBeUpdated = $(this).closest('tr')[0];
        var customerId = rowToBeUpdated.cells[0].innerText;
        ERKOSMS.GetAjaxDialog("Customer/EditCustomer?customerId=" + customerId, {}, false).then(function () {
        }), function (data) {
            ERKOSMS.ShowWarning(data);
        }
    });


    $('#customerListTable').on('click', 'td.editor-delete', function (e) {
        e.preventDefault();
        var rowToBeDelleted = $(this).closest('tr')[0]
        var customerId = rowToBeDelleted.cells[0].innerText
        vex.dialog.confirm({
            message: "Seçilen ürün silinecektir. Emin misiniz? ",
            callback: function (result) {
                if (result) {
                    ERKOSMS.AjaxAction("Customer/DeleteCustomer?customerId=" + customerId, {}, false).then(function () {
                        rowToBeDelleted.remove();
                    }), function (data) {
                        ERKOSMS.ShowWarning(data);
                    }
                }
            }
        });
    });

    var formatDate = function (date) {
        if (date == null) {
            return '';
        }
        else {
            return window.moment(date).format("DD-MM-YYYY");
        }

    }

    $("#getAllButtomn").on("click", function () {
        destroyTable();
        var tb = $("#customerListTable");
        ERKOSMS.AjaxAction("Customer/GetCustomers", {}, false).then(function (data) {
            var datatable = tb.DataTable({
                autoWidth: true,
                scrollX: true,
                columns: [
                    { title: "Id", data: "Id" },
                    { title: "İsim", data: "Name" },
                    { title: "Sahibi", data: "Owner" },
                    { title: "Sahibinin Telefonu", data: "OwnerMobile" },
                    { title: "Sahibinin Email Adresi", data: "OwnerMail" },
                    { title: "Yetkili", data: "Manager" },
                    { title: "Yetkilinin Telefonu", data: "ManagerMobile" },
                    { title: "Yetkilinin Email adresi", data: "ManagerEmail" },
                    { title: "Yetkilinin Ünvanı", data: "ManagerTitle" },
                    { title: "Adres", data: "Address" },
                    { title: "Şehir", data: "City" },
                    { title: "Ülke", data: "Country" },
                    { title: "Posta Kodu", data: "PostalCode" },
                    { title: "Telefon", data: "PhoneNumber" },
                    { title: "Ülke Kodu", data: "CountryCode" },
                    { title: "Faks", data: "FaxNumber" },
                    { title: "Durum", data: "Condition" },
                    { title: "İletişim Kaynağı", data: "CommunicationMethod" },
                    { title: "Başlangıç Tarihi", data: "StartDate" },
                    { title: "Firma İlgili Personel", data: "ContactPerson" },
                    { title: "Vergi Ofisi", data: "TaxOffice" },
                    { title: "Vergi Numarası", data: "TaxNumber" },
                    { title: "Para Birimi", data: "Currency" },
                    { title: "Bölge Kıta", data: "Region" },
                    { title: "İndirim Oranı", data: "DiscountRate" },
                    { title: "Satış Temsilcisi", data: "SalesRepresentative" },
                    { title: "Yorum", data: "Comment" },
                    {
                        data: null,
                        className: "dt-center editor-edit",
                        defaultContent: '<span class="btn btn-warning"><span class="glyphicon glyphicon-pencil"></span> Güncelle</span>',
                        orderable: false
                    },
                    {
                        data: null,
                        className: "dt-center editor-delete",
                        defaultContent: '<span class="btn btn-danger"><span class="glyphicon glyphicon-minus"></span> Sil</span>',
                        orderable: false
                    }
                ],
                data: data,
                sDom: '<"top"lif<"clear">>rt<"bottom"ip<"clear">>',
                aaSorting: [],      // Initial sorting
                bInfo: true,       // Info is not shown because the total count to show is not known
                searching: true,   // Disable searching TODO: Enable searching if necessary
                paging: true, // Disable paging in outstanding
                pageLength: 10,
                deferRender: true,
                columnDefs: [
                    {
                        targets: 18,
                        render: formatDate
                    }
                ]
            });
        });
    });


    $("#searchButton").on("click", function () {
        destroyTable();
        var tb = $("#customerListTable");
        var customerName = $("#customerName").val();
        ERKOSMS.AjaxAction("Customer/GetCustomer?customerName=" + customerName, {}, false).then(function (data) {
            var datatable = tb.DataTable({
                autoWidth: true,
                scrollX: true,
                columns: [
                    { title: "Id", data: "Id" },
                    { title: "İsim", data: "Name" },
                    { title: "Sahibi", data: "Owner" },
                    { title: "Sahibinin Telefonu", data: "OwnerMobile" },
                    { title: "Sahibinin Email Adresi", data: "OwnerMail" },
                    { title: "Yetkili", data: "Manager" },
                    { title: "Yetkilinin Telefonu", data: "ManagerMobile" },
                    { title: "Yetkilinin Email adresi", data: "ManagerEmail" },
                    { title: "Yetkilinin Ünvanı", data: "ManagerTitle" },
                    { title: "Adres", data: "Address" },
                    { title: "Şehir", data: "City" },
                    { title: "Ülke", data: "Country" },
                    { title: "Posta Kodu", data: "PostalCode" },
                    { title: "Telefon", data: "PhoneNumber" },
                    { title: "Ülke Kodu", data: "CountryCode" },
                    { title: "Faks", data: "FaxNumber" },
                    { title: "Durum", data: "Condition" },
                    { title: "İletişim Kaynağı", data: "CommunicationMethod" },
                    { title: "Başlangıç Tarihi", data: "StartDate" },
                    { title: "Firma İlgili Personel", data: "ContactPerson" },
                    { title: "Vergi Ofisi", data: "TaxOffice" },
                    { title: "Vergi Numarası", data: "TaxNumber" },
                    { title: "Para Birimi", data: "Currency" },
                    { title: "Bölge Kıta", data: "Region" },
                    { title: "İndirim Oranı", data: "DiscountRate" },
                    { title: "Satış Temsilcisi", data: "SalesRepresentative" },
                    { title: "Yorum", data: "Comment" },
                    {
                        data: null,
                        className: "dt-center editor-edit",
                        defaultContent: '<span class="btn btn-warning"><span class="glyphicon glyphicon-pencil"></span> Güncelle</span>',
                        orderable: false
                    },
                    {
                        data: null,
                        className: "dt-center editor-delete",
                        defaultContent: '<span class="btn btn-danger"><span class="glyphicon glyphicon-minus"></span> Sil</span>',
                        orderable: false
                    }
                ],
                data: data,
                sDom: '<"top"lif<"clear">>rt<"bottom"ip<"clear">>',
                aaSorting: [],      // Initial sorting
                bInfo: true,       // Info is not shown because the total count to show is not known
                searching: true,   // Disable searching TODO: Enable searching if necessary
                paging: true, // Disable paging in outstanding
                pageLength: 10,
                deferRender: true,
                columnDefs: [
                    {
                        targets: 18,
                        render: formatDate
                    }
                ]
            });
        });
    });




</script>